<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Art Challenge Generator</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #581c87 0%, #3730a3 50%, #1e3a8a 100%);
            padding: 2rem;
        }
        .container { max-width: 52rem; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 2rem; }
        .title { font-size: 3rem; font-weight: bold; color: white; margin-bottom: 0.75rem; }
        .subtitle { color: #e9d5ff; font-size: 1.125rem; }
        .streak { margin-top: 0.5rem; color: #fbbf24; font-weight: 600; font-size: 1rem; }
        .tabs { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
        .tab {
            flex: 1; padding: 0.75rem; background: rgba(255, 255, 255, 0.1);
            color: #e9d5ff; border: none; border-radius: 0.5rem;
            cursor: pointer; font-weight: 600; transition: all 0.3s;
        }
        .tab.active { background: rgba(255, 255, 255, 0.2); color: white; }
        .tab:hover { background: rgba(255, 255, 255, 0.15); }
        .options-panel {
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(12px);
            border-radius: 1rem; padding: 1.5rem; margin-bottom: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .options-title { color: white; font-weight: 600; font-size: 1.125rem; margin-bottom: 1rem; }
        .filter-group { margin-bottom: 1.5rem; }
        .filter-label {
            color: #e9d5ff; font-size: 0.875rem; font-weight: 600;
            margin-bottom: 0.5rem; display: block;
        }
        .checkbox-group { display: flex; flex-wrap: wrap; gap: 0.75rem; }
        .checkbox-item { display: flex; align-items: center; gap: 0.5rem; }
        .checkbox-item input[type="checkbox"] { width: 1.25rem; height: 1.25rem; cursor: pointer; }
        .checkbox-item label { color: white; cursor: pointer; font-size: 0.9rem; }
        select {
            width: 100%; padding: 0.75rem; border-radius: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1); color: white;
            font-size: 1rem; cursor: pointer;
        }
        select option { background: #1e3a8a; color: white; }
        .randomize-all-btn {
            width: 100%; padding: 1rem;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white; border: none; border-radius: 0.75rem;
            font-weight: bold; font-size: 1.125rem; cursor: pointer;
            transition: all 0.3s; margin-top: 1rem;
        }
        .randomize-all-btn:hover {
            transform: scale(1.02);
            background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
        }
        .card {
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(12px);
            border-radius: 1rem; padding: 2rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .initial-state { text-align: center; padding: 3rem 0; }
        .generate-btn {
            background: linear-gradient(135deg, #ec4899 0%, #a855f7 100%);
            color: white; font-weight: bold; font-size: 1.25rem;
            padding: 1rem 2rem; border: none; border-radius: 0.75rem;
            cursor: pointer; transition: all 0.3s;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
        }
        .generate-btn:hover {
            transform: scale(1.05);
            background: linear-gradient(135deg, #db2777 0%, #9333ea 100%);
        }
        .challenge-content { display: none; }
        .challenge-content.active { display: block; }
        .category-badge {
            display: inline-block; background: rgba(168, 85, 247, 0.3);
            padding: 0.5rem 1rem; border-radius: 9999px;
            margin-bottom: 1rem; text-align: center;
        }
        .category-text { color: #e9d5ff; font-size: 0.875rem; font-weight: 600; }
        .character-box {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.2) 0%, rgba(251, 146, 60, 0.2) 100%);
            border-radius: 0.75rem; padding: 1.5rem;
            border: 2px solid rgba(251, 191, 36, 0.5); margin-bottom: 1.5rem;
        }
        .underling-box {
            background: linear-gradient(135deg, rgba(96, 165, 250, 0.2) 0%, rgba(34, 211, 238, 0.2) 100%);
            border-radius: 0.75rem; padding: 1.5rem;
            border: 2px solid rgba(96, 165, 250, 0.5); margin-bottom: 1.5rem;
        }
        .box-label {
            color: #d1d5db; font-size: 0.875rem; text-transform: uppercase;
            letter-spacing: 0.05em; margin-bottom: 0.5rem;
        }
        .character-name { font-size: 2.25rem; font-weight: bold; color: white; }
        .underling-name { font-size: 1.875rem; font-weight: bold; color: white; }
        .challenge-specs { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem; }
        .spec-box {
            background: rgba(139, 92, 246, 0.2); border-radius: 0.75rem;
            padding: 1rem; border: 1px solid rgba(139, 92, 246, 0.4);
        }
        .spec-label {
            color: #c4b5fd; font-size: 0.75rem; text-transform: uppercase;
            letter-spacing: 0.05em; margin-bottom: 0.25rem;
        }
        .spec-value { color: white; font-weight: 600; font-size: 1.125rem; }
        .color-palette {
            background: rgba(139, 92, 246, 0.2); border-radius: 0.75rem;
            padding: 1rem; border: 1px solid rgba(139, 92, 246, 0.4);
            margin-bottom: 1.5rem;
        }
        .palette-colors { display: flex; gap: 0.5rem; margin-top: 0.5rem; }
        .color-swatch {
            flex: 1; height: 3rem; border-radius: 0.5rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        .challenge-description {
            background: rgba(255, 255, 255, 0.05); border-radius: 0.75rem;
            padding: 1.5rem; border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 1.5rem;
        }
        .challenge-title { color: white; font-weight: 600; font-size: 1.125rem; margin-bottom: 0.75rem; }
        .challenge-text { color: #e9d5ff; line-height: 1.625; }
        .highlight-character { color: #fcd34d; font-weight: 600; }
        .highlight-underling { color: #67e8f9; font-weight: 600; }
        .button-group { display: flex; gap: 1rem; flex-wrap: wrap; }
        .action-btn {
            flex: 1; min-width: 150px; font-weight: 600;
            padding: 0.75rem 1.5rem; border-radius: 0.75rem;
            cursor: pointer; transition: all 0.3s;
            display: flex; align-items: center; justify-content: center;
            gap: 0.5rem; border: none; font-size: 0.95rem;
        }
        .regenerate-btn {
            background: rgba(255, 255, 255, 0.1); color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .regenerate-btn:hover { background: rgba(255, 255, 255, 0.2); }
        .share-btn { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; }
        .share-btn:hover { background: linear-gradient(135deg, #059669 0%, #047857 100%); }
        .favorite-btn { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; }
        .favorite-btn:hover { background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); }
        .favorite-btn.favorited { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); }
        .history-list { max-height: 400px; overflow-y: auto; }
        .history-item {
            background: rgba(255, 255, 255, 0.05); padding: 1rem;
            border-radius: 0.5rem; margin-bottom: 0.75rem;
            cursor: pointer; transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .history-item:hover { background: rgba(255, 255, 255, 0.1); }
        .history-item-title { color: white; font-weight: 600; margin-bottom: 0.25rem; }
        .history-item-details { color: #e9d5ff; font-size: 0.875rem; }
        .empty-state { text-align: center; padding: 3rem; color: #e9d5ff; }
        .tip { margin-top: 1.5rem; text-align: center; color: #e9d5ff; font-size: 0.875rem; }
        .center-badge { text-align: center; }
        .toast {
            position: fixed; top: 2rem; right: 2rem; background: #10b981;
            color: white; padding: 1rem 1.5rem; border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
            opacity: 0; transition: opacity 0.3s; z-index: 1000;
        }
        .toast.show { opacity: 1; }
        @media (max-width: 640px) {
            .challenge-specs { grid-template-columns: 1fr; }
            .button-group { flex-direction: column; }
            .action-btn { min-width: auto; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">‚ú® Daily Art Challenge ‚ú®</h1>
            <p class="subtitle">Generate your character for today's creative challenge!</p>
            <div class="streak">
                <span id="streakDisplay">üî• 0 day streak</span>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('options')">‚öôÔ∏è Options</button>
            <button class="tab" onclick="switchTab('history')">üìú History</button>
            <button class="tab" onclick="switchTab('favorites')">‚≠ê Favorites</button>
        </div>

        <div class="options-panel">
            <div id="optionsTab" class="tab-content active">
                <h2 class="options-title">Challenge Settings</h2>
                
                <div class="filter-group">
                    <label class="filter-label">Select All/None:</label>
                    <div class="checkbox-group">
                        <button onclick="selectAllCats()" style="padding: 0.5rem 1rem; background: rgba(255,255,255,0.1); color: white; border: none; border-radius: 0.5rem; cursor: pointer;">Select All</button>
                        <button onclick="deselectAllCats()" style="padding: 0.5rem 1rem; background: rgba(255,255,255,0.1); color: white; border: none; border-radius: 0.5rem; cursor: pointer;">Deselect All</button>
                    </div>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Mythology:</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="greek" class="cat-check" checked>
                            <label for="greek">Greek</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="norse" class="cat-check" checked>
                            <label for="norse">Norse</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="egyptian" class="cat-check" checked>
                            <label for="egyptian">Egyptian</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="celtic" class="cat-check" checked>
                            <label for="celtic">Celtic</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="japanese" class="cat-check" checked>
                            <label for="japanese">Japanese</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="hindu" class="cat-check" checked>
                            <label for="hindu">Hindu</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="aztec" class="cat-check" checked>
                            <label for="aztec">Aztec/Mayan</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="slavic" class="cat-check" checked>
                            <label for="slavic">Slavic</label>
                        </div>
                    </div>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Fantasy Types:</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="fantasy" class="cat-check" checked>
                            <label for="fantasy">Classic</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="fantasySea" class="cat-check" checked>
                            <label for="fantasySea">Sea</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="fantasyUrban" class="cat-check" checked>
                            <label for="fantasyUrban">Urban</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="fantasyWestern" class="cat-check" checked>
                            <label for="fantasyWestern">Western</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="fantasySteam" class="cat-check" checked>
                            <label for="fantasySteam">Steampunk</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="fantasyHorror" class="cat-check" checked>
                            <label for="fantasyHorror">Horror</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="scifi" class="cat-check" checked>
                            <label for="scifi">Sci-Fi</label>
                        </div>
                    </div>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Companions:</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="includeUnderling" checked>
                            <label for="includeUnderling">Main Underling</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="includeSecondary" checked>
                            <label for="includeSecondary">Extra Minions (0-2)</label>
                        </div>
                    </div>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Character Details:</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="includeOutfit">
                            <label for="includeOutfit">Outfit</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="includeHairColor">
                            <label for="includeHairColor">Hair</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="includeEyeColor">
                            <label for="includeEyeColor">Eyes</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="includeExpression">
                            <label for="includeExpression">Expression</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="includeWeapon">
                            <label for="includeWeapon">Weapon</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="includeAge">
                            <label for="includeAge">Age</label>
                        </div>
                    </div>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Visual Elements:</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="includePose">
                            <label for="includePose">Pose</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="includeLighting">
                            <label for="includeLighting">Lighting</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="includeBackground">
                            <label for="includeBackground">Background</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="includeColorPalette">
                            <label for="includeColorPalette">Palette</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="includeComposition">
                            <label for="includeComposition">Composition</label>
                        </div>
                    </div>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Other:</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="preventRepeats">
                            <label for="preventRepeats">Prevent Repeats</label>
                        </div>
                    </div>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Difficulty:</label>
                    <select id="difficulty">
                        <option value="easy">Easy - Simple pose or portrait</option>
                        <option value="medium" selected>Medium - Action scene</option>
                        <option value="hard">Hard - Complex composition</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Art Style:</label>
                    <select id="artStyle">
                        <option value="random" selected>Random</option>
                        <option value="digital">Digital Painting</option>
                        <option value="watercolor">Watercolor</option>
                        <option value="ink">Ink Drawing</option>
                        <option value="pixel">Pixel Art</option>
                        <option value="sketch">Pencil Sketch</option>
                        <option value="oil">Oil Painting</option>
                        <option value="anime">Anime Style</option>
                        <option value="comic">Comic Book</option>
                        <option value="realistic">Photorealistic</option>
                        <option value="stylized">Stylized</option>
                    </select>
                </div>

                <button class="randomize-all-btn" onclick="randomizeAll()">
                    üé≤ Randomize All Settings
                </button>
            </div>

            <div id="historyTab" class="tab-content">
                <h2 class="options-title">Recent Challenges</h2>
                <div id="historyList" class="history-list"></div>
            </div>

            <div id="favoritesTab" class="tab-content">
                <h2 class="options-title">Favorite Challenges</h2>
                <div id="favoritesList" class="history-list"></div>
            </div>
        </div>

        <div class="card">
            <div id="initialState" class="initial-state">
                <button class="generate-btn" onclick="testGenerate()">
                    ‚ú® Generate Challenge
                </button>
            </div>

            <div id="challengeContent" class="challenge-content">
                <div class="center-badge">
                    <div class="category-badge">
                        <span class="category-text" id="categoryText"></span>
                    </div>
                </div>

                <div class="character-box">
                    <h2 class="box-label">Main Character</h2>
                    <p class="character-name" id="characterName"></p>
                </div>

                <div class="underling-box" id="underlingSection">
                    <h2 class="box-label">Companions</h2>
                    <p class="underling-name" id="underlingName"></p>
                </div>

                <div id="colorPaletteSection" class="color-palette" style="display: none;">
                    <div class="spec-label">Color Palette</div>
                    <div class="palette-colors" id="paletteColors"></div>
                </div>

                <div class="challenge-specs" id="specsContainer"></div>

                <div class="challenge-description">
                    <h3 class="challenge-title">Your Challenge:</h3>
                    <p class="challenge-text" id="challengeText"></p>
                </div>

                <div class="button-group">
                    <button class="action-btn regenerate-btn" onclick="testGenerate()">üîÑ New</button>
                    <button class="action-btn favorite-btn" id="favoriteBtn" onclick="toggleFav()">‚≠ê Favorite</button>
                    <button class="action-btn share-btn" onclick="share()">üì§ Copy</button>
                </div>
            </div>
        </div>

        <div class="tip">
            <p>üí° Tip: ~280 characters across 15+ categories!</p>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
console.log('Script loading...');

// Simplified character data for testing
var simpleChars = [
    {name:"Zeus",cat:"Greek Mythology",main:"Storm Eagle",sec:["Thunder Herald","Cloud Sprite"]},
    {name:"Athena",cat:"Greek Mythology",main:"Owl Companion",sec:["Shield Bearer"]},
    {name:"Odin",cat:"Norse Mythology",main:"Raven Huginn",sec:["Raven Muninn","Wolf Geri"]},
    {name:"Thor",cat:"Norse Mythology",main:"Storm Valkyrie",sec:["Thunder Goat"]},
    {name:"Ra",cat:"Egyptian Mythology",main:"Solar Barque",sec:["Scarab Swarm"]},
    {name:"Anubis",cat:"Egyptian Mythology",main:"Jackal Guardian",sec:["Mummy Servant"]},
    {name:"Morrigan",cat:"Celtic Mythology",main:"Battle Crow",sec:["War Raven"]},
    {name:"Amaterasu",cat:"Japanese Mythology",main:"Sun Mirror",sec:["Sacred Crow"]},
    {name:"Shiva",cat:"Hindu Mythology",main:"Nandi Bull",sec:["Cobra Naga"]},
    {name:"Quetzalcoatl",cat:"Aztec Mythology",main:"Feathered Serpent",sec:["Wind Spirit"]},
    {name:"Baba Yaga",cat:"Slavic Mythology",main:"Mortar & Pestle",sec:["Chicken Leg Hut"]},
    {name:"Paladin",cat:"Fantasy",main:"Squire",sec:["Holy Banner"]},
    {name:"Necromancer",cat:"Fantasy",main:"Skeleton Minion",sec:["Zombie Thrall"]},
    {name:"Kraken Summoner",cat:"Fantasy - Sea",main:"Tentacle Horror",sec:["Deep One"]},
    {name:"Urban Witch",cat:"Fantasy - Urban",main:"Street Cat",sec:["Graffiti Spirit"]},
    {name:"Gunslinger Mage",cat:"Fantasy - Western",main:"Cactus Elemental",sec:["Tumbleweed Spirit"]},
    {name:"Steam Knight",cat:"Fantasy - Steampunk",main:"Piston Squire",sec:["Coal Golem"]},
    {name:"Eldritch Cultist",cat:"Fantasy - Horror",main:"Void Tentacle",sec:["Mad Acolyte"]},
    {name:"Cyber Samurai",cat:"Sci-Fi Fantasy",main:"Combat Drone",sec:["Nano Blade"]}
];

var styles=["Digital Painting","Watercolor","Ink Drawing","Pixel Art","Pencil Sketch","Oil Painting","Anime Style","Comic Book Style","Photorealistic","Stylized/Cartoon"];
var outfits=["Armored","Robed","Casual","Royal","Battle-worn","Elegant","Tattered","Ceremonial"];
var hair=["Black","Brown","Blonde","Red","White","Silver","Blue","Purple","Green","Pink"];
var eyes=["Blue","Green","Brown","Hazel","Gray","Amber","Violet","Red","Gold","Silver"];
var expressions=["Determined","Mysterious","Fierce","Serene","Menacing","Joyful","Confident","Playful"];
var weapons=["Enchanted Sword","Staff of Power","Dual Daggers","War Hammer","Bow & Arrow","Magic Tome"];
var ages=["Young (Teen)","Young Adult","Middle-Aged","Mature","Elderly","Ancient"];
var poses=["Combat Stance","Casting Spell","Meditating","Mid-Leap","Walking","Arms Crossed"];
var lighting=["Dramatic Shadows","Morning Light","Neon Glow","Moonlight","Golden Hour","Fire Glow"];
var bgs=["Ancient Temple","Cyberpunk Alley","Enchanted Forest","Mountain Peak","Throne Room","Battlefield"];
var compositions=["Rule of Thirds","Central Focus","Dynamic Diagonal","Golden Ratio","Symmetrical"];
var palettes=[
    {name:"Fire & Ash",colors:["#FF4500","#FF6347","#8B0000","#2F1B10","#FFD700"]},
    {name:"Ocean Depths",colors:["#006994","#0A97B0","#5DADE2","#1C2833","#A8DADC"]},
    {name:"Cyber Neon",colors:["#FF00FF","#00FFFF","#FF1493","#1A1A2E","#FFFF00"]}
];
var diffs={easy:"Simple pose or portrait",medium:"Action scene or interaction",hard:"Complex composition with environment"};

var curr=null,hist=[],favs=[],recent=[],streak=0,lastDate='';

function load(){
    try{
        var h=localStorage.getItem('hist');if(h)hist=JSON.parse(h);
        var f=localStorage.getItem('favs');if(f)favs=JSON.parse(f);
        var r=localStorage.getItem('recent');if(r)recent=JSON.parse(r);
        var s=localStorage.getItem('streak');if(s)streak=parseInt(s);
        var d=localStorage.getItem('lastDate');if(d)lastDate=d;
        updateStreakDisplay();
    }catch(e){console.error('Load error:',e);}
}

function save(){
    try{
        localStorage.setItem('hist',JSON.stringify(hist.slice(0,50)));
        localStorage.setItem('favs',JSON.stringify(favs));
        localStorage.setItem('recent',JSON.stringify(recent.slice(0,20)));
        localStorage.setItem('streak',streak.toString());
        localStorage.setItem('lastDate',lastDate);
    }catch(e){console.error('Save error:',e);}
}

function updateStreak(){
    var today=new Date().toDateString();
    if(lastDate===today)return;
    var yesterday=new Date();
    yesterday.setDate(yesterday.getDate()-1);
    if(lastDate===yesterday.toDateString()){streak++;}
    else if(lastDate!==''){streak=1;}
    else{streak=1;}
    lastDate=today;
    save();
    updateStreakDisplay();
}

function updateStreakDisplay(){
    var sd=document.getElementById('streakDisplay');
    if(sd)sd.textContent='üî• '+streak+' day streak';
}

function switchTab(t){
    var tabs=document.querySelectorAll('.tab');
    var conts=document.querySelectorAll('.tab-content');
    tabs.forEach(function(x){x.classList.remove('active');});
    conts.forEach(function(x){x.classList.remove('active');});
    if(t==='options'){
        tabs[0].classList.add('active');
        document.getElementById('optionsTab').classList.add('active');
    }else if(t==='history'){
        tabs[1].classList.add('active');
        document.getElementById('historyTab').classList.add('active');
        renderHist();
    }else if(t==='favorites'){
        tabs[2].classList.add('active');
        document.getElementById('favoritesTab').classList.add('active');
        renderFavs();
    }
}

function renderHist(){
    var c=document.getElementById('historyList');
    if(hist.length===0){
        c.innerHTML='<div class="empty-state">No challenges yet!</div>';
        return;
    }
    var h='';
    for(var i=hist.length-1;i>=0&&i>=hist.length-20;i--){
        var ch=hist[i];
        h+='<div class="history-item" onclick="loadHist('+i+')"><div class="history-item-title">'+ch.character+'</div><div class="history-item-details">'+ch.category+' ‚Ä¢ '+ch.style+'</div></div>';
    }
    c.innerHTML=h;
}

function renderFavs(){
    var c=document.getElementById('favoritesList');
    if(favs.length===0){
        c.innerHTML='<div class="empty-state">No favorites yet!</div>';
        return;
    }
    var h='';
    for(var i=0;i<favs.length;i++){
        var ch=favs[i];
        h+='<div class="history-item" onclick="loadFav('+i+')"><div class="history-item-title">'+ch.character+'</div><div class="history-item-details">'+ch.category+' ‚Ä¢ '+ch.style+'</div></div>';
    }
    c.innerHTML=h;
}

function loadHist(i){curr=hist[i];display();switchTab('options');}
function loadFav(i){curr=favs[i];display();switchTab('options');}

function toggleFav(){
    if(!curr)return;
    var isFav=favs.some(function(f){return f.character===curr.character&&f.timestamp===curr.timestamp;});
    if(isFav){
        favs=favs.filter(function(f){return!(f.character===curr.character&&f.timestamp===curr.timestamp);});
        document.getElementById('favoriteBtn').classList.remove('favorited');
        toast('Removed from favorites');
    }else{
        favs.push(curr);
        document.getElementById('favoriteBtn').classList.add('favorited');
        toast('Added to favorites!');
    }
    save();
}

function selectAllCats(){
    var checks=document.querySelectorAll('.cat-check');
    checks.forEach(function(c){c.checked=true;});
}

function deselectAllCats(){
    var checks=document.querySelectorAll('.cat-check');
    checks.forEach(function(c){c.checked=false;});
}

function randomizeAll(){
    var checks=document.querySelectorAll('.cat-check');
    checks.forEach(function(c){c.checked=Math.random()>0.5;});
    var anyChecked=Array.from(checks).some(function(c){return c.checked;});
    if(!anyChecked)checks[0].checked=true;
    
    document.getElementById('includeUnderling').checked=Math.random()>0.3;
    document.getElementById('includeSecondary').checked=Math.random()>0.5;
    document.getElementById('includeOutfit').checked=Math.random()>0.5;
    document.getElementById('includeHairColor').checked=Math.random()>0.5;
    document.getElementById('includeEyeColor').checked=Math.random()>0.5;
    document.getElementById('includeExpression').checked=Math.random()>0.5;
    document.getElementById('includeWeapon').checked=Math.random()>0.5;
    document.getElementById('includeAge').checked=Math.random()>0.5;
    document.getElementById('includePose').checked=Math.random()>0.5;
    document.getElementById('includeLighting').checked=Math.random()>0.5;
    document.getElementById('includeBackground').checked=Math.random()>0.5;
    document.getElementById('includeColorPalette').checked=Math.random()>0.5;
    document.getElementById('includeComposition').checked=Math.random()>0.5;
    
    var ds=['easy','medium','hard'];
    document.getElementById('difficulty').value=ds[Math.floor(Math.random()*ds.length)];
    var ss=['random','digital','watercolor','ink','pixel','sketch','oil','anime','comic','realistic','stylized'];
    document.getElementById('artStyle').value=ss[Math.floor(Math.random()*ss.length)];
    toast('Randomized!');
}

function getFiltered(){
    var g=document.getElementById('greek').checked;
    var n=document.getElementById('norse').checked;
    var e=document.getElementById('egyptian').checked;
    var c=document.getElementById('celtic').checked;
    var j=document.getElementById('japanese').checked;
    var h=document.getElementById('hindu').checked;
    var az=document.getElementById('aztec').checked;
    var sl=document.getElementById('slavic').checked;
    var f=document.getElementById('fantasy').checked;
    var fs=document.getElementById('fantasySea').checked;
    var fu=document.getElementById('fantasyUrban').checked;
    var fw=document.getElementById('fantasyWestern').checked;
    var fst=document.getElementById('fantasySteam').checked;
    var fh=document.getElementById('fantasyHorror').checked;
    var s=document.getElementById('scifi').checked;
    
    var filtered=simpleChars.filter(function(ch){
        if(ch.cat==='Greek Mythology')return g;
        if(ch.cat==='Norse Mythology')return n;
        if(ch.cat==='Egyptian Mythology')return e;
        if(ch.cat==='Celtic Mythology')return c;
        if(ch.cat==='Japanese Mythology')return j;
        if(ch.cat==='Hindu Mythology')return h;
        if(ch.cat==='Aztec Mythology'||ch.cat==='Mayan Mythology')return az;
        if(ch.cat==='Slavic Mythology')return sl;
        if(ch.cat==='Fantasy')return f;
        if(ch.cat==='Fantasy - Sea')return fs;
        if(ch.cat==='Fantasy - Urban')return fu;
        if(ch.cat==='Fantasy - Western')return fw;
        if(ch.cat==='Fantasy - Steampunk')return fst;
        if(ch.cat==='Fantasy - Horror')return fh;
        if(ch.cat==='Sci-Fi Fantasy')return s;
        return false;
    });
    
    var pr=document.getElementById('preventRepeats').checked;
    if(pr&&recent.length>0){
        filtered=filtered.filter(function(ch){return recent.indexOf(ch.name)===-1;});
        if(filtered.length===0){recent=[];return getFiltered();}
    }
    return filtered;
}

function testGenerate(){
    console.log('Generate clicked!');
    var filtered=getFiltered();
    console.log('Filtered chars:',filtered.length);
    
    if(filtered.length===0){
        alert('Select at least one category!');
        return;
    }
    
    var ch=filtered[Math.floor(Math.random()*filtered.length)];
    console.log('Selected char:',ch.name);
    
    var artSel=document.getElementById('artStyle').value;
    var selStyle;
    if(artSel==='random'){
        selStyle=styles[Math.floor(Math.random()*styles.length)];
    }else{
        var m={digital:'Digital Painting',watercolor:'Watercolor',ink:'Ink Drawing',pixel:'Pixel Art',sketch:'Pencil Sketch',oil:'Oil Painting',anime:'Anime Style',comic:'Comic Book Style',realistic:'Photorealistic',stylized:'Stylized/Cartoon'};
        selStyle=m[artSel];
    }
    
    var diff=document.getElementById('difficulty').value;
    var diffText=diff.charAt(0).toUpperCase()+diff.slice(1);
    
    var hasU=document.getElementById('includeUnderling').checked;
    var hasSec=document.getElementById('includeSecondary').checked;
    
    var underlings=[];
    if(hasU)underlings.push(ch.main);
    if(hasSec&&ch.sec&&ch.sec.length>0){
        var numSec=Math.random()<0.5?1:(Math.random()<0.7?2:0);
        for(var i=0;i<numSec&&i<ch.sec.length;i++){
            underlings.push(ch.sec[i]);
        }
    }
    
    var hasO=document.getElementById('includeOutfit').checked;
    var hasH=document.getElementById('includeHairColor').checked;
    var hasE=document.getElementById('includeEyeColor').checked;
    var hasExp=document.getElementById('includeExpression').checked;
    var hasW=document.getElementById('includeWeapon').checked;
    var hasA=document.getElementById('includeAge').checked;
    var hasP=document.getElementById('includePose').checked;
    var hasL=document.getElementById('includeLighting').checked;
    var hasB=document.getElementById('includeBackground').checked;
    var hasC=document.getElementById('includeColorPalette').checked;
    var hasCo=document.getElementById('includeComposition').checked;
    
    curr={
        character:ch.name,
        underlings:underlings,
        category:ch.cat,
        difficulty:diffText,
        style:selStyle,
        difficultyDesc:diffs[diff],
        outfit:hasO?outfits[Math.floor(Math.random()*outfits.length)]:null,
        hairColor:hasH?hair[Math.floor(Math.random()*hair.length)]:null,
        eyeColor:hasE?eyes[Math.floor(Math.random()*eyes.length)]:null,
        expression:hasExp?expressions[Math.floor(Math.random()*expressions.length)]:null,
        weapon:hasW?weapons[Math.floor(Math.random()*weapons.length)]:null,
        age:hasA?ages[Math.floor(Math.random()*ages.length)]:null,
        pose:hasP?poses[Math.floor(Math.random()*poses.length)]:null,
        lighting:hasL?lighting[Math.floor(Math.random()*lighting.length)]:null,
        background:hasB?bgs[Math.floor(Math.random()*bgs.length)]:null,
        palette:hasC?palettes[Math.floor(Math.random()*palettes.length)]:null,
        composition:hasCo?compositions[Math.floor(Math.random()*compositions.length)]:null,
        timestamp:Date.now(),
        code:generateCode()
    };
    
    recent.push(ch.name);
    if(recent.length>10)recent.shift();
    hist.push(curr);
    updateStreak();
    save();
    display();
}

function generateCode(){
    var chars='ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
    var code='';
    for(var i=0;i<4;i++){
        code+=chars.charAt(Math.floor(Math.random()*chars.length));
    }
    return code;
}

function display(){
    console.log('Displaying challenge...');
    document.getElementById('categoryText').textContent=curr.category;
    document.getElementById('characterName').textContent=curr.character;
    
    var underlingSection=document.getElementById('underlingSection');
    if(curr.underlings&&curr.underlings.length>0){
        underlingSection.style.display='block';
        document.getElementById('underlingName').textContent=curr.underlings.join(', ');
    }else{
        underlingSection.style.display='none';
    }
    
    var pSec=document.getElementById('colorPaletteSection');
    if(curr.palette){
        pSec.style.display='block';
        var pH='';
        for(var i=0;i<curr.palette.colors.length;i++){
            pH+='<div class="color-swatch" style="background-color:'+curr.palette.colors[i]+'"></div>';
        }
        document.getElementById('paletteColors').innerHTML=pH;
    }else{
        pSec.style.display='none';
    }
    
    var sH='<div class="spec-box"><div class="spec-label">Difficulty</div><div class="spec-value">'+curr.difficulty+'</div></div>';
    sH+='<div class="spec-box"><div class="spec-label">Art Style</div><div class="spec-value">'+curr.style+'</div></div>';
    
    if(curr.outfit)sH+='<div class="spec-box"><div class="spec-label">Outfit</div><div class="spec-value">'+curr.outfit+'</div></div>';
    if(curr.hairColor)sH+='<div class="spec-box"><div class="spec-label">Hair</div><div class="spec-value">'+curr.hairColor+'</div></div>';
    if(curr.eyeColor)sH+='<div class="spec-box"><div class="spec-label">Eyes</div><div class="spec-value">'+curr.eyeColor+'</div></div>';
    if(curr.expression)sH+='<div class="spec-box"><div class="spec-label">Expression</div><div class="spec-value">'+curr.expression+'</div></div>';
    if(curr.weapon)sH+='<div class="spec-box"><div class="spec-label">Weapon</div><div class="spec-value">'+curr.weapon+'</div></div>';
    if(curr.age)sH+='<div class="spec-box"><div class="spec-label">Age</div><div class="spec-value">'+curr.age+'</div></div>';
    if(curr.pose)sH+='<div class="spec-box"><div class="spec-label">Pose</div><div class="spec-value">'+curr.pose+'</div></div>';
    if(curr.lighting)sH+='<div class="spec-box"><div class="spec-label">Lighting</div><div class="spec-value">'+curr.lighting+'</div></div>';
    if(curr.background)sH+='<div class="spec-box"><div class="spec-label">Background</div><div class="spec-value">'+curr.background+'</div></div>';
    if(curr.composition)sH+='<div class="spec-box"><div class="spec-label">Composition</div><div class="spec-value">'+curr.composition+'</div></div>';
    if(curr.code)sH+='<div class="spec-box" style="grid-column: span 2;"><div class="spec-label">Challenge Code</div><div class="spec-value" style="font-size: 2rem; letter-spacing: 0.2em;">'+curr.code+'</div></div>';
    
    document.getElementById('specsContainer').innerHTML=sH;
    
    var pT='Create a <span class="highlight-character">'+curr.style+'</span> artwork featuring <span class="highlight-character">'+curr.character+'</span>';
    
    if(curr.underlings&&curr.underlings.length>0){
        pT+=' alongside ';
        if(curr.underlings.length===1){
            pT+='their <span class="highlight-underling">'+curr.underlings[0]+'</span>';
        }else if(curr.underlings.length===2){
            pT+='their <span class="highlight-underling">'+curr.underlings[0]+'</span> and <span class="highlight-underling">'+curr.underlings[1]+'</span>';
        }else{
            for(var i=0;i<curr.underlings.length;i++){
                if(i===curr.underlings.length-1){
                    pT+='and <span class="highlight-underling">'+curr.underlings[i]+'</span>';
                }else{
                    pT+='<span class="highlight-underling">'+curr.underlings[i]+'</span>, ';
                }
            }
        }
    }
    pT+='. ';
    
    var det=[];
    if(curr.age)det.push('<span class="highlight-character">'+curr.age+'</span>');
    if(curr.expression)det.push('with a <span class="highlight-character">'+curr.expression+'</span> expression');
    if(curr.pose)det.push('in a <span class="highlight-character">'+curr.pose+'</span> pose');
    if(curr.outfit)det.push('<span class="highlight-character">wearing '+curr.outfit+' attire</span>');
    if(curr.hairColor)det.push('with <span class="highlight-character">'+curr.hairColor+' hair</span>');
    if(curr.eyeColor)det.push('<span class="highlight-character">'+curr.eyeColor+' eyes</span>');
    if(curr.weapon)det.push('holding <span class="highlight-character">'+curr.weapon+'</span>');
    
    if(det.length>0)pT+='The character should be depicted '+det.join(', ')+'. ';
    if(curr.background)pT+='Set in <span class="highlight-character">'+curr.background+'</span>. ';
    if(curr.lighting)pT+='Use <span class="highlight-character">'+curr.lighting+'</span>. ';
    if(curr.composition)pT+='Composition: <span class="highlight-character">'+curr.composition+'</span>. ';
    if(curr.palette)pT+='Palette: <span class="highlight-character">'+curr.palette.name+'</span>. ';
    pT+='<strong>'+curr.difficultyDesc+'.</strong> ';
    
    if(curr.underlings&&curr.underlings.length>0){
        pT+='Consider their relationship!';
    }else{
        pT+='Show their personality!';
    }
    
    document.getElementById('challengeText').innerHTML=pT;
    
    var isFav=favs.some(function(f){return f.character===curr.character&&f.timestamp===curr.timestamp;});
    var fb=document.getElementById('favoriteBtn');
    if(isFav){
        fb.classList.add('favorited');
        fb.innerHTML='‚≠ê Favorited';
    }else{
        fb.classList.remove('favorited');
        fb.innerHTML='‚≠ê Favorite';
    }
    
    document.getElementById('initialState').style.display='none';
    document.getElementById('challengeContent').classList.add('active');
}

function share(){
    if(!curr)return;
    var t='üé® Daily Art Challenge üé®\n\nüìú Character: '+curr.character+'\n';
    if(curr.underlings&&curr.underlings.length>0)t+='üë• Companions: '+curr.underlings.join(', ')+'\n';
    t+='üìÇ Category: '+curr.category+'\n‚ö° Difficulty: '+curr.difficulty+'\nüñåÔ∏è Style: '+curr.style+'\n';
    if(curr.outfit)t+='üëî Outfit: '+curr.outfit+'\n';
    if(curr.hairColor)t+='üíá Hair: '+curr.hairColor+'\n';
    if(curr.eyeColor)t+='üëÅÔ∏è Eyes: '+curr.eyeColor+'\n';
    if(curr.expression)t+='üòä Expression: '+curr.expression+'\n';
    if(curr.weapon)t+='‚öîÔ∏è Weapon: '+curr.weapon+'\n';
    if(curr.age)t+='üë§ Age: '+curr.age+'\n';
    if(curr.pose)t+='ü§∏ Pose: '+curr.pose+'\n';
    if(curr.lighting)t+='üí° Lighting: '+curr.lighting+'\n';
    if(curr.background)t+='üèûÔ∏è Background: '+curr.background+'\n';
    if(curr.composition)t+='üìê Composition: '+curr.composition+'\n';
    if(curr.palette)t+='üé® Palette: '+curr.palette.name+'\n';
    if(curr.code)t+='üî¢ Code: '+curr.code+'\n';
    t+='\n‚ú® '+curr.difficultyDesc;
    
    if(navigator.clipboard&&navigator.clipboard.writeText){
        navigator.clipboard.writeText(t).then(function(){toast('Copied!');}).catch(function(){alert(t);});
    }else{
        alert(t);
    }
}

function toast(m){
    var t=document.getElementById('toast');
    t.textContent=m;
    t.classList.add('show');
    setTimeout(function(){t.classList.remove('show');},3000);
}

window.addEventListener('DOMContentLoaded',function(){
    console.log('Page loaded');
    load();
});
    </script>
</body>
</html>
